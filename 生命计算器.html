<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äººç”Ÿæ—¶é—´è®¡ç®—å™¨ V7 â€“ ç”Ÿå‘½ç²’å­æµåŠ¨ç‰ˆ</title>
<style>
body {
  font-family: 'Inter','PingFang SC','Microsoft YaHei',sans-serif;
  margin: 0;
  padding: 40px 0;
  background: radial-gradient(circle at 30% 30%, #eaf6ff 0%, #f8fdff 100%);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  color: #333;
}
.container {
  width: 720px;
  background: rgba(255,255,255,0.85);
  backdrop-filter: blur(12px);
  border-radius: 20px;
  box-shadow: 0 10px 35px rgba(0,80,160,0.12);
  padding: 40px 45px;
  transition: transform .3s;
}
.container:hover { transform: translateY(-2px);}
h2 {
  text-align:center;
  font-size:28px;
  font-weight:700;
  background:linear-gradient(90deg,#0dcaf0,#20c997);
  -webkit-background-clip:text;
  color:transparent;
  margin-bottom:30px;
}

/* --- è¾“å…¥åŒº --- */
.section-title{
  font-weight:700;
  color:#0d6efd;
  margin-top:25px;margin-bottom:15px;
  border-left:4px solid #20c997;
  padding-left:10px;
  background:#f7fbff;
  border-radius:4px;
  padding:6px 10px;
}
.input-group{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
.input-group label{flex-basis:45%;text-align:right;font-weight:600;color:#555;}
.input-group input,.input-group select{
  flex-basis:50%;
  border:1.4px solid #d8d8d8;
  border-radius:8px;
  padding:9px 12px;
  text-align:center;
  transition:border-color .3s, box-shadow .3s;
}
.input-group input:focus,.input-group select:focus{
  border-color:#0dcaf0;
  box-shadow:0 0 0 3px rgba(13,202,240,0.2);
  outline:none;
}
.holiday-group{display:flex;flex-wrap:wrap;justify-content:space-between;}
.holiday-input{flex-basis:48%;margin-bottom:10px;}
button{
  width:100%;padding:15px;
  background:linear-gradient(90deg,#28a745,#20c997);
  border:none;border-radius:10px;color:#fff;
  font-size:18px;font-weight:600;cursor:pointer;
  transition:all .3s;
}
button:hover{box-shadow:0 8px 20px rgba(32,201,151,0.4);transform:translateY(-2px);}

/* --- ç»“æœåŒº --- */
.result{
  margin-top:35px;
  background:rgba(255,255,255,0.9);
  border-radius:14px;
  padding:25px;
  box-shadow:0 6px 20px rgba(0,0,0,0.05);
  animation:fadeIn .6s ease forwards;
  display:none;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(15px);}to{opacity:1;transform:translateY(0);}}
.result h3{text-align:center;color:#0dcaf0;margin-bottom:15px;}

/* --- ç²’å­è¿›åº¦æ¡ --- */
.progress-box{
  background:rgba(245,250,255,0.7);
  border-radius:12px;
  padding:15px 10px 20px;
  backdrop-filter:blur(5px);
  margin-bottom:10px;
}
.progress-label{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  color:#555;
  padding:0 6px 5px;
}
.grain-progress{
  display:flex;
  justify-content:space-between;
  align-items:center;
  height:18px;
  overflow:hidden;
}
.grain{
  width:7px;height:7px;
  border-radius:50%;
  background:gray;
  box-shadow:0 1px 2px rgba(0,0,0,0.1);
  opacity:0;transform:translateY(4px);
  animation:popIn .4s ease forwards;
}
@keyframes popIn{
  to{opacity:1;transform:translateY(0);}
}

/* æ¸å˜é£æ ¼é¢—ç²’ */
.free-grain{background:linear-gradient(135deg,#34eb83,#0fd65f);}
.sleep-grain{background:linear-gradient(135deg,#5bc0de,#007bff);}
.work-grain{background:linear-gradient(135deg,#ffaf4b,#ff7b00);}
.grain::after{
  content:'';
  display:block;
  width:100%;height:100%;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%,rgba(255,255,255,0.6),transparent 60%);
}

/* åŠ¨æ€é—ªçƒå…‰æ³½æ•ˆæœ */
@keyframes shimmer{
  0%{filter:brightness(1);}
  50%{filter:brightness(1.3);}
  100%{filter:brightness(1);}
}

/* --- åœ†ç¯å›¾ --- */
canvas{display:block;margin:25px auto;}

/* ç»“æœæ–‡å­— */
.result-item{
  display:flex;
  justify-content:space-between;
  border-bottom:1px dashed #cce3f7;
  padding:8px 0;
  font-size:16px;
}
.result-item strong{color:#333;font-weight:700;}
.busy-time{color:#dc3545;}
.legend{display:flex;justify-content:space-around;font-size:13px;color:#555;margin:8px 0;}
.dot{width:12px;height:12px;border-radius:2px;display:inline-block;margin-right:5px;}
.dot.free{background:#34eb83;}
.dot.sleep{background:#007bff;}
.dot.work{background:#ff7b00;}
</style>
</head>
<body>
<div class="container">
  <h2>ğŸ’« äººç”Ÿæ—¶é—´åˆ†æä»ª V7</h2>

  <div class="section-title">ğŸ‘¤ ä¸ªäººä¿¡æ¯</div>
  <div class="input-group"><label>ğŸ‚ ç”Ÿæ—¥</label><input type="date" id="birthDate" value="1994-04-19"></div>
  <div class="input-group"><label>ğŸ‘´ æœŸæœ›å¯¿å‘½</label><input type="number" id="lifespan" value="80"></div>
  <div class="input-group"><label>ğŸ’¼ é€€ä¼‘å¹´é¾„</label><input type="number" id="retirementAge" value="65"></div>

  <div class="section-title">ğŸ•“ æ—¥å¸¸èŠ‚å¥</div>
  <div class="input-group"><label>æ¯å‘¨ä¼‘æ¯å¤©æ•°</label>
    <select id="weeklyRestDays"><option value="2">2 å¤© (åŒä¼‘)</option><option value="1">1 å¤©</option><option value="3">3 å¤©</option><option value="0">0 å¤©</option></select>
  </div>
  <div class="input-group"><label>ğŸ˜´ ç¡çœ  (å°æ—¶)</label><input type="number" id="sleepHours" value="8"></div>
  <div class="input-group"><label>ğŸ’» å·¥ä½œ (å°æ—¶)</label><input type="number" id="workHours" value="8.5"></div>
  <div class="input-group"><label>ğŸš— é€šå‹¤ (å°æ—¶)</label><input type="number" id="commuteHours" value="1.5"></div>

  <div class="section-title">ğŸ§§ å¹´åº¦æ³•å®šå‡æœŸ</div>
  <div class="holiday-group">
    <div class="holiday-input input-group"><label>å…ƒæ—¦</label><input type="number" id="holiday_yuandan" value="1"></div>
    <div class="holiday-input input-group"><label>æ˜¥èŠ‚</label><input type="number" id="holiday_chunjie" value="4"></div>
    <div class="holiday-input input-group"><label>æ¸…æ˜</label><input type="number" id="holiday_qingming" value="1"></div>
    <div class="holiday-input input-group"><label>åŠ³åŠ¨èŠ‚</label><input type="number" id="holiday_laodong" value="2"></div>
    <div class="holiday-input input-group"><label>ç«¯åˆ</label><input type="number" id="holiday_duanwu" value="1"></div>
    <div class="holiday-input input-group"><label>ä¸­ç§‹</label><input type="number" id="holiday_zhongqiu" value="1"></div>
    <div class="holiday-input input-group"><label>å›½åº†</label><input type="number" id="holiday_guoqing" value="3"></div>
  </div>

  <button onclick="calculateTime()">ğŸ¯ å¼€å§‹åˆ†æ</button>

  <div id="resultOutput" class="result">
    <h3>ğŸ“Š æ—¶é—´åˆ†å¸ƒå¯è§†åŒ–</h3>
    <canvas id="donutChart" width="200" height="200"></canvas>
    <div class="progress-box">
      <div class="progress-label">
        <span>ğŸ§˜ è‡ªç”±</span><span>ğŸ˜´ ç¡çœ </span><span>ğŸ’¼ å·¥ä½œ</span>
      </div>
      <div id="grainProgress" class="grain-progress"></div>
    </div>
    <div class="legend">
      <span><span class="dot free"></span> è‡ªç”±</span>
      <span><span class="dot sleep"></span> ç¡çœ </span>
      <span><span class="dot work"></span> å·¥ä½œ/é€šå‹¤</span>
    </div>
    <div class="result-item"><span>ğŸ§˜ è‡ªç”±æ—¶é—´</span><strong id="freeTimeText"></strong></div>
    <div class="result-item"><span>ğŸ˜´ ç¡çœ æ—¶é—´</span><strong id="sleepTimeText"></strong></div>
    <div class="result-item"><span>ğŸ’¼ å·¥ä½œ/é€šå‹¤</span><strong class="busy-time" id="busyTimeText"></strong></div>
  </div>
</div>

<script>
function calculateTime(){
  const get=id=>parseFloat(document.getElementById(id).value)||0;
  const birth=new Date(document.getElementById('birthDate').value);
  const lifespan=get('lifespan'), retire=get('retirementAge');
  const restDay=parseInt(document.getElementById('weeklyRestDays').value);
  const workH=get('workHours'), commute=get('commuteHours'), sleep=get('sleepHours');
  const holidays=['yuandan','chunjie','qingming','laodong','duanwu','zhongqiu','guoqing'].map(i=>get('holiday_'+i));
  const stat=holidays.reduce((a,b)=>a+b,0);
  const DAYS=365.25;
  const today=new Date();today.setHours(0,0,0,0);
  const retireDate=new Date(birth);retireDate.setFullYear(birth.getFullYear()+retire);
  const endDate=new Date(birth);endDate.setFullYear(birth.getFullYear()+lifespan);
  if(sleep+workH+commute>24){alert('æ—¶é—´è¶…è¿‡24å°æ—¶');return;}
  const totalDays=Math.ceil((endDate-today)/(86400000));
  const workDays=Math.max(0,Math.ceil((retireDate-today)/86400000));
  const retireDays=totalDays-workDays;
  const weekend=DAYS*(restDay/7);
  const workNoHoliday=DAYS-weekend;
  const netHoliday=stat*(workNoHoliday/DAYS);
  const restDaysPerY=weekend+netHoliday;
  const workDaysPerY=DAYS-restDaysPerY;
  const wr=workDaysPerY/DAYS, rr=restDaysPerY/DAYS;
  const workDayFree=24-(workH+commute)-sleep;
  const restDayFree=24-sleep;
  const free=(workDays*wr*workDayFree)+(workDays*rr*restDayFree)+(retireDays*restDayFree);
  const sleepT=totalDays*sleep;
  const busy=workDays*wr*(workH+commute);
  const output=document.getElementById('resultOutput');
  output.style.display='block';
  function fmt(h){return `${Math.round(h).toLocaleString()} å°æ—¶ (â‰ˆ ${(h/(24*DAYS)).toFixed(2)} å¹´)`;}
  document.getElementById('freeTimeText').innerText=fmt(free);
  document.getElementById('sleepTimeText').innerText=fmt(sleepT);
  document.getElementById('busyTimeText').innerText=fmt(busy);

  // ç²’å­å›¾
  const total=free+sleepT+busy;
  const ratio=[free/total,sleepT/total,busy/total];
  const container=document.getElementById('grainProgress');
  container.innerHTML='';
  const totalGrains=80;
  let index=0;
  const freeCount=Math.round(totalGrains*ratio[0]);
  const sleepCount=Math.round(totalGrains*ratio[1]);
  const workCount=totalGrains-freeCount-sleepCount;
  const seq=[...Array(totalGrains).keys()];
  const render=()=>{
    if(index>=totalGrains)return;
    const g=document.createElement('div');
    g.classList.add('grain');
    if(index<freeCount) g.classList.add('free-grain');
    else if(index<freeCount+sleepCount) g.classList.add('sleep-grain');
    else g.classList.add('work-grain');
    g.style.animationDelay=`${index*0.03}s`;
    container.appendChild(g);
    index++;
    requestAnimationFrame(render);
  };
  render();

  // åœ†ç¯
  const ctx=document.getElementById('donutChart').getContext('2d');
  ctx.clearRect(0,0,200,200);
  const cx=100,cy=100,r=70;
  const colors=['#34eb83','#007bff','#ff7b00'];
  let start=-Math.PI/2;
  ratio.forEach((p,i)=>{
    ctx.beginPath();
    ctx.strokeStyle=colors[i];
    ctx.lineWidth=25;
    ctx.arc(cx,cy,r,start,start+2*Math.PI*p);
    ctx.stroke();
    start+=2*Math.PI*p;
  });
  ctx.font='bold 18px Arial';
  ctx.fillStyle='#333';
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  ctx.fillText(`${Math.round(ratio[0]*100)}% è‡ªç”±`,cx,cy);
}
window.onload=calculateTime;
</script>
</body>
</html>
